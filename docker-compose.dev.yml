version: '3.8'

services:
  # Backend with hot-reload for development
  backend-dev:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: user-management-backend-dev
    ports:
      - "3000:3000"
      - "9229:9229" # Debug port
    environment:
      - NODE_ENV=development
      - PORT=3000
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_USER=root
      - DB_PASSWORD=rootpassword
      - DB_NAME=user_management
    volumes:
      - ./backend/src:/app/src
      - ./backend/package.json:/app/package.json
    networks:
      - user-management-network
    depends_on:
      - mysql

  # Frontend with hot-reload for development
  frontend-dev:
    build:
      context: ./frontend/user-management-ui
      dockerfile: Dockerfile.dev
    container_name: user-management-frontend-dev
    ports:
      - "4200:4200"
    volumes:
      - ./frontend/user-management-ui/src:/app/src
      - ./frontend/user-management-ui/package.json:/app/package.json
    networks:
      - user-management-network

  # MySQL (same as production)
  mysql:
    image: mysql:8.0
    container_name: user-management-mysql-dev
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=user_management
      - MYSQL_USER=user
      - MYSQL_PASSWORD=userpassword
    volumes:
      - mysql_data_dev:/var/lib/mysql
    networks:
      - user-management-network
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 5

networks:
  user-management-network:
    driver: bridge

volumes:
  mysql_data_dev:
